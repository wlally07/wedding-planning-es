<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard — WeddingPlanning.es</title>
<meta name="robots" content="noindex, nofollow">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Lora:ital,wght@0,400;0,500;1,400&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --champagne: #E8D5B7; --champagne-light: #F5EDE0; --champagne-pale: #FBF7F1;
  --rose: #C4918A; --rose-deep: #A66E68; --rose-light: #E8C5C0;
  --sage: #9CAF88; --sage-deep: #7A9166;
  --olive: #6B705C; --cream: #FEFCF8; --charcoal: #2D2926;
  --warm-gray: #6E6862; --light-gray: #E8E4DF;
  --gold: #C9A96E; --gold-light: #DFC99E; --white: #FFFFFF;
  --shadow-sm: 0 1px 3px rgba(45,41,38,0.06); --shadow-md: 0 4px 16px rgba(45,41,38,0.08);
  --radius: 12px; --radius-lg: 20px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Lora', serif; background: var(--cream); color: var(--charcoal); line-height: 1.7; }

/* LOGIN SCREEN */
.login-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 24px; }
.login-card { background: var(--white); padding: 48px 40px; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); max-width: 400px; width: 100%; text-align: center; }
.login-card h1 { font-family: 'Playfair Display', serif; font-size: 1.6rem; margin-bottom: 4px; }
.login-card p { font-size: 0.88rem; color: var(--warm-gray); margin-bottom: 32px; }
.login-card .logo { font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 600; margin-bottom: 24px; }
.login-card .logo span { color: var(--rose); }
.form-field { text-align: left; margin-bottom: 20px; }
.form-field label { font-family: 'Montserrat', sans-serif; font-size: 0.72rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; color: var(--charcoal); display: block; margin-bottom: 8px; }
.form-field input { width: 100%; padding: 14px 18px; border: 1.5px solid var(--light-gray); border-radius: var(--radius); font-family: 'Lora', serif; font-size: 0.95rem; outline: none; transition: border 0.3s; background: var(--cream); }
.form-field input:focus { border-color: var(--rose); }
.login-error { display: none; color: var(--rose-deep); font-family: 'Montserrat', sans-serif; font-size: 0.8rem; margin-bottom: 16px; }

/* DASHBOARD */
.dashboard { display: none; }
header { background: var(--white); border-bottom: 1px solid var(--light-gray); padding: 16px 32px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
.header-left { display: flex; align-items: center; gap: 24px; }
.logo { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 600; text-decoration: none; color: var(--charcoal); }
.logo span { color: var(--rose); }
.header-badge { font-family: 'Montserrat', sans-serif; font-size: 0.68rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; background: var(--charcoal); color: var(--white); padding: 4px 12px; border-radius: 50px; }
.header-right { display: flex; align-items: center; gap: 16px; }
.header-right a { font-family: 'Montserrat', sans-serif; font-size: 0.78rem; color: var(--warm-gray); text-decoration: none; }
.header-right a:hover { color: var(--rose); }

.container { max-width: 1200px; margin: 0 auto; padding: 32px 24px; }

/* STATS */
.stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
.stat-card { background: var(--white); padding: 24px; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); text-align: center; }
.stat-number { font-family: 'Playfair Display', serif; font-size: 2.2rem; font-weight: 700; }
.stat-number.pending { color: var(--rose-deep); }
.stat-number.approved { color: var(--sage-deep); }
.stat-number.featured { color: var(--gold); }
.stat-number.total { color: var(--charcoal); }
.stat-label { font-family: 'Montserrat', sans-serif; font-size: 0.7rem; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; color: var(--warm-gray); margin-top: 4px; }

/* SECTIONS */
.panel { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); margin-bottom: 24px; overflow: hidden; }
.panel-header { padding: 24px 28px; border-bottom: 1px solid var(--light-gray); display: flex; align-items: center; justify-content: space-between; }
.panel-header h2 { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 500; }
.panel-header .count { font-family: 'Montserrat', sans-serif; font-size: 0.72rem; font-weight: 700; background: var(--champagne-pale); padding: 4px 12px; border-radius: 50px; color: var(--warm-gray); }
.panel-body { padding: 0; }
.panel-empty { padding: 40px; text-align: center; color: var(--warm-gray); font-family: 'Montserrat', sans-serif; font-size: 0.88rem; }

/* TABLE */
table { width: 100%; border-collapse: collapse; }
th { font-family: 'Montserrat', sans-serif; font-size: 0.7rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--warm-gray); text-align: left; padding: 14px 20px; border-bottom: 1px solid var(--light-gray); background: var(--champagne-pale); }
td { padding: 16px 20px; border-bottom: 1px solid rgba(232,213,183,0.2); font-size: 0.9rem; vertical-align: middle; }
tr:hover td { background: var(--champagne-pale); }
.business-name { font-family: 'Playfair Display', serif; font-weight: 600; font-size: 1rem; }
.business-meta { font-family: 'Montserrat', sans-serif; font-size: 0.72rem; color: var(--warm-gray); margin-top: 2px; }
.business-bio { font-size: 0.82rem; color: var(--warm-gray); max-width: 300px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-top: 4px; }

/* TAGS */
.tag-row { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
.tag { font-family: 'Montserrat', sans-serif; font-size: 0.65rem; padding: 3px 10px; border-radius: 50px; background: var(--champagne-pale); color: var(--warm-gray); }

/* BUTTONS */
.btn { font-family: 'Montserrat', sans-serif; font-size: 0.72rem; font-weight: 600; letter-spacing: 0.5px; padding: 8px 18px; border: none; border-radius: 50px; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; gap: 6px; }
.btn:hover { transform: translateY(-1px); }
.btn-approve { background: var(--sage); color: white; }
.btn-approve:hover { background: var(--sage-deep); }
.btn-reject { background: #F8D7DA; color: #721C24; }
.btn-reject:hover { background: #f1b0b7; }
.btn-suspend { background: #FFF3CD; color: #856404; }
.btn-suspend:hover { background: #ffe69c; }
.btn-feature { background: var(--light-gray); color: var(--warm-gray); }
.btn-feature.active { background: var(--gold); color: white; }
.btn-feature:hover { background: var(--gold-light); color: var(--charcoal); }
.btn-login { background: var(--rose); color: white; width: 100%; justify-content: center; padding: 14px; font-size: 0.82rem; border-radius: var(--radius); }
.btn-login:hover { background: var(--rose-deep); }
.btn-logout { background: none; border: 1px solid var(--light-gray); color: var(--warm-gray); padding: 6px 16px; }
.action-btns { display: flex; gap: 8px; }
.date-cell { font-family: 'Montserrat', sans-serif; font-size: 0.78rem; color: var(--warm-gray); }

/* TOAST */
.toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
.toast { font-family: 'Montserrat', sans-serif; font-size: 0.82rem; padding: 14px 24px; border-radius: var(--radius); background: var(--charcoal); color: white; box-shadow: var(--shadow-md); animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s forwards; }
.toast.error { background: var(--rose-deep); }
.toast.success { background: var(--sage-deep); }
@keyframes toastIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes toastOut { from { opacity: 1; } to { opacity: 0; transform: translateY(-10px); } }

/* DETAIL PANEL */
.detail-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 500; }
.detail-panel { position: fixed; top: 0; right: 0; bottom: 0; width: 520px; background: var(--white); z-index: 501; box-shadow: -4px 0 32px rgba(0,0,0,0.15); overflow-y: auto; transform: translateX(100%); transition: transform 0.3s ease; }
.detail-panel.open { transform: translateX(0); }
.detail-header { padding: 24px 28px; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center; }
.detail-close { background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--warm-gray); }
.detail-body { padding: 28px; }
.detail-body h2 { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 4px; }
.detail-row { margin-bottom: 20px; }
.detail-label { font-family: 'Montserrat', sans-serif; font-size: 0.7rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--warm-gray); margin-bottom: 4px; }
.detail-value { font-size: 0.92rem; }

@media (max-width: 768px) {
  .stats-row { grid-template-columns: repeat(2, 1fr); }
  .detail-panel { width: 100%; }
  th, td { padding: 12px 14px; font-size: 0.82rem; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-card">
    <div class="logo">Wedding<span>Planning</span>.es</div>
    <h1>Admin Dashboard</h1>
    <p>Sign in to manage listings and approvals.</p>
    <div class="form-field">
      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="admin@weddingplanning.es">
    </div>
    <div class="form-field">
      <label>Password</label>
      <input type="password" id="loginPassword" placeholder="Enter password" onkeydown="if(event.key==='Enter')doLogin()">
    </div>
    <p class="login-error" id="loginError">Invalid credentials. Please try again.</p>
    <button class="btn btn-login" onclick="doLogin()">Sign In</button>
  </div>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboard">
  <header>
    <div class="header-left">
      <a class="logo" href="/">Wedding<span>Planning</span>.es</a>
      <span class="header-badge">Admin</span>
    </div>
    <div class="header-right">
      <a href="/" target="_blank">View Site ↗</a>
      <button class="btn btn-logout" onclick="doLogout()">Sign Out</button>
    </div>
  </header>

  <div class="container">
    <!-- STATS -->
    <div class="stats-row">
      <div class="stat-card"><div class="stat-number pending" id="statPending">0</div><div class="stat-label">Pending Review</div></div>
      <div class="stat-card"><div class="stat-number approved" id="statApproved">0</div><div class="stat-label">Approved</div></div>
      <div class="stat-card"><div class="stat-number featured" id="statFeatured">0</div><div class="stat-label">Featured on Home</div></div>
      <div class="stat-card"><div class="stat-number total" id="statTotal">0</div><div class="stat-label">Total Listings</div></div>
    </div>

    <!-- PENDING -->
    <div class="panel" id="pendingPanel">
      <div class="panel-header">
        <h2>Pending Approvals</h2>
        <span class="count" id="pendingCount">0</span>
      </div>
      <div class="panel-body" id="pendingBody">
        <div class="panel-empty">Loading...</div>
      </div>
    </div>

    <!-- APPROVED -->
    <div class="panel">
      <div class="panel-header">
        <h2>Approved Listings</h2>
        <span class="count" id="approvedCount">0</span>
      </div>
      <div class="panel-body" id="approvedBody">
        <div class="panel-empty">Loading...</div>
      </div>
    </div>

    <!-- REJECTED / SUSPENDED -->
    <div class="panel">
      <div class="panel-header">
        <h2>Rejected / Suspended</h2>
        <span class="count" id="rejectedCount">0</span>
      </div>
      <div class="panel-body" id="rejectedBody">
        <div class="panel-empty">None</div>
      </div>
    </div>
  </div>
</div>

<!-- DETAIL SLIDE-OUT -->
<div class="detail-overlay" id="detailOverlay" onclick="closeDetail()"></div>
<div class="detail-panel" id="detailPanel">
  <div class="detail-header">
    <h3 style="font-family:'Montserrat',sans-serif;font-size:0.72rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--warm-gray);">Listing Details</h3>
    <button class="detail-close" onclick="closeDetail()">✕</button>
  </div>
  <div class="detail-body" id="detailBody"></div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toastContainer"></div>

<script>
const SUPABASE_URL = 'https://timntczlwpcoohbvdqss.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpbW50Y3psd3Bjb29oYnZkcXNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMjUwODksImV4cCI6MjA4NzcwMTA4OX0.ukv65Or6XcjID3L0HgilTm7GUsg5Na3gRaGOgT2oQbw';

// Simple admin password (change this!)
const ADMIN_PASSWORD = 'WeddingAdmin2025';

let vendors = [];

// ===== AUTH =====
function doLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  if (password === ADMIN_PASSWORD) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    loadVendors();
  } else {
    document.getElementById('loginError').style.display = 'block';
  }
}

function doLogout() {
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('loginPassword').value = '';
}

// ===== LOAD DATA =====
async function loadVendors() {
  try {
    const res = await fetch(
      SUPABASE_URL + '/rest/v1/vendors?select=*&order=created_at.desc',
      { headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': 'Bearer ' + SUPABASE_ANON_KEY } }
    );
    if (!res.ok) throw new Error('Load failed');
    vendors = await res.json();
    renderAll();
  } catch (err) {
    document.getElementById('pendingBody').innerHTML = '<div class="panel-empty">Error loading data. Check console.</div>';
    console.error(err);
  }
}

// ===== RENDER =====
function renderAll() {
  const pending = vendors.filter(v => v.status === 'pending');
  const approved = vendors.filter(v => v.status === 'approved');
  const rejected = vendors.filter(v => v.status === 'rejected' || v.status === 'suspended');
  const featured = approved.filter(v => v.is_featured);

  // Stats
  document.getElementById('statPending').textContent = pending.length;
  document.getElementById('statApproved').textContent = approved.length;
  document.getElementById('statFeatured').textContent = featured.length;
  document.getElementById('statTotal').textContent = vendors.length;
  document.getElementById('pendingCount').textContent = pending.length;
  document.getElementById('approvedCount').textContent = approved.length;
  document.getElementById('rejectedCount').textContent = rejected.length;

  // Pending panel highlight
  document.getElementById('pendingPanel').style.border = pending.length > 0 ? '2px solid var(--rose-light)' : 'none';

  // Pending
  if (pending.length === 0) {
    document.getElementById('pendingBody').innerHTML = '<div class="panel-empty">All clear! No pending listings. ✓</div>';
  } else {
    document.getElementById('pendingBody').innerHTML = '<table><thead><tr><th>Business</th><th>Location</th><th>Submitted</th><th style="width:200px;">Actions</th></tr></thead><tbody>' +
      pending.map(v => `<tr>
        <td>
          <div class="business-name">${esc(v.business_name)}</div>
          <div class="business-meta">${esc(v.contact_name || '')} · ${esc(v.email || '')}</div>
          <div class="business-bio">${esc(v.description || '')}</div>
        </td>
        <td>${esc(v.address || '-')}</td>
        <td class="date-cell">${formatDate(v.created_at)}</td>
        <td>
          <div class="action-btns">
            <button class="btn btn-approve" onclick="updateStatus('${v.id}','approved')">✓ Approve</button>
            <button class="btn btn-reject" onclick="updateStatus('${v.id}','rejected')">✕ Reject</button>
            <button class="btn" style="background:none;border:1px solid var(--light-gray);color:var(--warm-gray);padding:8px 12px;" onclick="viewDetail('${v.id}')">View</button>
          </div>
        </td>
      </tr>`).join('') + '</tbody></table>';
  }

  // Approved
  if (approved.length === 0) {
    document.getElementById('approvedBody').innerHTML = '<div class="panel-empty">No approved listings yet.</div>';
  } else {
    document.getElementById('approvedBody').innerHTML = '<table><thead><tr><th>Business</th><th>Location</th><th>Services</th><th>Homepage</th><th style="width:160px;">Actions</th></tr></thead><tbody>' +
      approved.map(v => `<tr>
        <td>
          <div class="business-name">${esc(v.business_name)}</div>
          <div class="business-meta">${esc(v.contact_name || '')} · ${esc(v.email || '')}</div>
        </td>
        <td>${esc(v.address || '-')}</td>
        <td>
          <div class="tag-row">${(v.services_offered || []).map(s => '<span class="tag">' + esc(s) + '</span>').join('')}</div>
        </td>
        <td style="text-align:center;">
          <button class="btn btn-feature ${v.is_featured ? 'active' : ''}" onclick="toggleFeatured('${v.id}', ${!v.is_featured})">
            ${v.is_featured ? '⭐ Featured' : '☆ Feature'}
          </button>
        </td>
        <td>
          <div class="action-btns">
            <button class="btn" style="background:none;border:1px solid var(--light-gray);color:var(--warm-gray);padding:8px 12px;" onclick="viewDetail('${v.id}')">View</button>
            <button class="btn btn-suspend" onclick="updateStatus('${v.id}','suspended')">Suspend</button>
          </div>
        </td>
      </tr>`).join('') + '</tbody></table>';
  }

  // Rejected
  if (rejected.length === 0) {
    document.getElementById('rejectedBody').innerHTML = '<div class="panel-empty">None</div>';
  } else {
    document.getElementById('rejectedBody').innerHTML = '<table><thead><tr><th>Business</th><th>Status</th><th>Date</th><th style="width:140px;">Actions</th></tr></thead><tbody>' +
      rejected.map(v => `<tr>
        <td><div class="business-name">${esc(v.business_name)}</div><div class="business-meta">${esc(v.email || '')}</div></td>
        <td><span style="font-family:'Montserrat',sans-serif;font-size:0.75rem;font-weight:600;color:${v.status==='rejected'?'#721C24':'#856404'};">${v.status}</span></td>
        <td class="date-cell">${formatDate(v.created_at)}</td>
        <td><button class="btn btn-approve" onclick="updateStatus('${v.id}','approved')">Reinstate</button></td>
      </tr>`).join('') + '</tbody></table>';
  }
}

// ===== ACTIONS =====
async function updateStatus(id, newStatus) {
  const vendor = vendors.find(v => v.id === id);
  if (!vendor) return;

  try {
    const body = { status: newStatus };
    if (newStatus === 'approved') body.approved_at = new Date().toISOString();

    const res = await fetch(SUPABASE_URL + '/rest/v1/vendors?id=eq.' + id, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_ANON_KEY, 'Authorization': 'Bearer ' + SUPABASE_ANON_KEY, 'Prefer': 'return=representation' },
      body: JSON.stringify(body)
    });
    if (!res.ok) throw new Error('Update failed');

    vendor.status = newStatus;
    renderAll();
    showToast(vendor.business_name + ' → ' + newStatus, 'success');
  } catch (err) {
    showToast('Error updating ' + vendor.business_name, 'error');
    console.error(err);
  }
}

async function toggleFeatured(id, shouldFeature) {
  const vendor = vendors.find(v => v.id === id);
  if (!vendor) return;

  try {
    const res = await fetch(SUPABASE_URL + '/rest/v1/vendors?id=eq.' + id, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json', 'apikey': SUPABASE_ANON_KEY, 'Authorization': 'Bearer ' + SUPABASE_ANON_KEY, 'Prefer': 'return=representation' },
      body: JSON.stringify({ is_featured: shouldFeature })
    });
    if (!res.ok) throw new Error('Update failed');

    vendor.is_featured = shouldFeature;
    renderAll();
    showToast(vendor.business_name + (shouldFeature ? ' added to Homepage ⭐' : ' removed from Homepage'), 'success');
  } catch (err) {
    showToast('Error updating featured status', 'error');
    console.error(err);
  }
}

// ===== DETAIL PANEL =====
function viewDetail(id) {
  const v = vendors.find(x => x.id === id);
  if (!v) return;

  document.getElementById('detailBody').innerHTML = `
    <h2>${esc(v.business_name)}</h2>
    <p style="color:var(--warm-gray);font-size:0.88rem;margin-bottom:24px;">
      <span style="font-family:'Montserrat',sans-serif;font-size:0.72rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;padding:4px 12px;border-radius:50px;background:${v.status==='approved'?'var(--sage)':v.status==='pending'?'var(--rose-light)':'#F8D7DA'};color:${v.status==='approved'?'white':v.status==='pending'?'var(--rose-deep)':'#721C24'};">${v.status}</span>
      ${v.is_featured ? '<span style="margin-left:8px;">⭐ Featured on Homepage</span>' : ''}
    </p>

    <div class="detail-row"><div class="detail-label">Contact Name</div><div class="detail-value">${esc(v.contact_name || '-')}</div></div>
    <div class="detail-row"><div class="detail-label">Email</div><div class="detail-value">${esc(v.email || '-')}</div></div>
    <div class="detail-row"><div class="detail-label">Phone</div><div class="detail-value">${esc(v.phone || '-')}</div></div>
    <div class="detail-row"><div class="detail-label">Location</div><div class="detail-value">${esc(v.address || '-')}</div></div>
    <div class="detail-row"><div class="detail-label">Website</div><div class="detail-value">${v.website ? '<a href="'+esc(v.website)+'" target="_blank" style="color:var(--rose);">'+esc(v.website)+'</a>' : '-'}</div></div>
    <div class="detail-row"><div class="detail-label">Starting Price</div><div class="detail-value">${v.starting_price ? '€' + esc(v.starting_price) : '-'}</div></div>
    <div class="detail-row"><div class="detail-label">Experience</div><div class="detail-value">${esc(v.years_experience || '-')}</div></div>
    <div class="detail-row"><div class="detail-label">Languages</div><div class="detail-value">${(v.languages || []).join(', ') || '-'}</div></div>
    <div class="detail-row"><div class="detail-label">Services</div><div class="detail-value"><div class="tag-row">${(v.services_offered || []).map(s => '<span class="tag">' + esc(s) + '</span>').join('')}</div></div></div>
    <div class="detail-row"><div class="detail-label">Bio</div><div class="detail-value" style="line-height:1.7;">${esc(v.description || '-')}</div></div>
    <div class="detail-row"><div class="detail-label">Submitted</div><div class="detail-value">${formatDate(v.created_at)}</div></div>

    <div style="display:flex;gap:8px;margin-top:28px;padding-top:20px;border-top:1px solid var(--light-gray);">
      ${v.status === 'pending' ? '<button class="btn btn-approve" onclick="updateStatus(\''+v.id+'\',\'approved\');closeDetail()">✓ Approve</button><button class="btn btn-reject" onclick="updateStatus(\''+v.id+'\',\'rejected\');closeDetail()">✕ Reject</button>' : ''}
      ${v.status === 'approved' ? '<button class="btn btn-feature '+(v.is_featured?'active':'')+'" onclick="toggleFeatured(\''+v.id+'\','+ !v.is_featured+');closeDetail()">'+(v.is_featured?'⭐ Remove from Home':'☆ Feature on Home')+'</button><button class="btn btn-suspend" onclick="updateStatus(\''+v.id+'\',\'suspended\');closeDetail()">Suspend</button>' : ''}
      ${v.status === 'rejected' || v.status === 'suspended' ? '<button class="btn btn-approve" onclick="updateStatus(\''+v.id+'\',\'approved\');closeDetail()">Reinstate</button>' : ''}
    </div>
  `;

  document.getElementById('detailOverlay').style.display = 'block';
  document.getElementById('detailPanel').classList.add('open');
}

function closeDetail() {
  document.getElementById('detailOverlay').style.display = 'none';
  document.getElementById('detailPanel').classList.remove('open');
}

// ===== HELPERS =====
function esc(str) { const d = document.createElement('div'); d.textContent = str; return d.innerHTML; }
function formatDate(iso) { return new Date(iso).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }); }

function showToast(message, type) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = 'toast' + (type ? ' ' + type : '');
  toast.textContent = message;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}
</script>
</body>
</html>
